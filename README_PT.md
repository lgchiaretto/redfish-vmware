# Redfish VMware Server

> **Note:** This application is generated by AI and represents a Redfish-to-VMware bridge solution.

This project provides a **Redfish** server that acts as a bridge between Redfish (REST API) calls and VMware vSphere operations, allowing you to control VMware VMs through the industry-standard Redfish protocol.


üéØ **VMware Redfish Bridge**
- **‚úÖ Compatible with OpenShift Metal3 - Complete asynchronous task system**
- **üêõ ADVANCED DEBUG MODE - Complete Metal3/Ironic failure diagnostics**
- **üìã Dynamic Task Management - Dynamic task system with real-time progress**
- **üö® CRITICAL ENDPOINT MONITORING - Alerts for critical Metal3 endpoints**
- **üèóÔ∏è MODULAR ARCHITECTURE - Code organized in specialized modules**

## üèóÔ∏è Modular Architecture

This project has been completely **modularized** for better maintainability and scalability:

### üìÅ Directory Structure

```
src/
‚îú‚îÄ‚îÄ redfish_server.py           # Main server (191 lines)
‚îú‚îÄ‚îÄ vmware_client.py            # Modularized VMware client (120 lines)
‚îú‚îÄ‚îÄ handlers/                   # Specialized Redfish handlers
‚îÇ   ‚îú‚îÄ‚îÄ redfish_handler.py      # Main Redfish handler
‚îÇ   ‚îú‚îÄ‚îÄ systems_handler.py      # System/VM management
‚îÇ   ‚îú‚îÄ‚îÄ managers_handler.py     # BMC manager management
‚îÇ   ‚îú‚îÄ‚îÄ chassis_handler.py      # Chassis management
‚îÇ   ‚îú‚îÄ‚îÄ update_service_handler.py # Update services
‚îÇ   ‚îî‚îÄ‚îÄ http_handler.py         # Base HTTP handler
‚îú‚îÄ‚îÄ auth/                       # Authentication system
‚îÇ   ‚îî‚îÄ‚îÄ manager.py              # Authentication and session manager
‚îú‚îÄ‚îÄ tasks/                      # Asynchronous task system
‚îÇ   ‚îî‚îÄ‚îÄ manager.py              # Metal3 task manager
‚îú‚îÄ‚îÄ utils/                      # System utilities
‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py       # Logging configuration
‚îî‚îÄ‚îÄ vmware/                     # Specialized VMware operations
    ‚îú‚îÄ‚îÄ connection.py           # vSphere connection management
    ‚îú‚îÄ‚îÄ vm_operations.py        # Basic VM operations
    ‚îú‚îÄ‚îÄ power_operations.py     # Power operations (on/off)
    ‚îî‚îÄ‚îÄ media_operations.py     # Media operations (ISO/CD-ROM)
```

### üîß Modularization Benefits

- **Separation of Concerns** - Each module has a specific function
- **Maintainability** - Easy bug location and fixing
- **Scalability** - Easy addition of new features
- **Testability** - Each module can be tested independently
- **Reusability** - Components can be reused in other projects
- **Readability** - Cleaner and more organized code

## üåü Main Features

- **Complete Redfish server** - Implements standard Redfish endpoints with HTTPS
- **Dynamic Asynchronous Task System** - Automatic task management with real-time progress
- **Advanced Metal3 debugging** - Detailed logs of all Ironic operations
- **UpdateService & TaskService** - Firmware update services and asynchronous task management
- **EventService** - Event service for system notifications and alerts
- **FirmwareInventory & SoftwareInventory** - Complete inventory of firmware and software components
- **Enhanced RAID Support** - Asynchronous RAID operations with volume creation and deletion
- **Metal3 Inspection Ready** - Specific endpoints for hardware inspection by OpenShift
- **Zero Failed Queries** - Smart system that prevents failures in Metal3 periodic queries
- **Real-time Task Progress** - Tasks with real-time progress and auto-completion

## üîß Metal3/Ironic Improvements (v1.0)

### ‚úÖ Issues Resolved in this version

- **‚ùå RedfishFirmware._query_update_failed** ‚Üí ‚úÖ **Resolved** - Asynchronous task system for firmware
- **‚ùå RedfishManagement._query_firmware_update_failed** ‚Üí ‚úÖ **Resolved** - Firmware operations always successful
- **‚ùå RedfishRAID._query_raid_config_failed** ‚Üí ‚úÖ **Resolved** - Asynchronous RAID system with dynamic tasks
- **‚ùå RedfishPower._query_power_state_failed** ‚Üí ‚úÖ **Resolved** - Power states always available
- **‚ùå RedfishBoot._query_boot_config_failed** ‚Üí ‚úÖ **Resolved** - Boot configurations always respond
- **‚ùå RedfishInspection._query_hardware_failed** ‚Üí ‚úÖ **Resolved** - Complete hardware inspection implemented

### üÜï Novas Funcionalidades Implementadas (v3.0)

#### ÔøΩ 1. Sistema de Debug Avan√ßado para Metal3
- **CRITICAL ENDPOINT ALERTS** - Logs de WARNING para endpoints cr√≠ticos do Metal3
- **BIOS FIRMWARE MONITORING** - Alertas espec√≠ficos para requests `/UpdateService/FirmwareInventory/BIOS`
- **FAILED TASK DETECTION** - Detec√ß√£o autom√°tica de tasks com falha para alertar Metal3
- **REQUEST/RESPONSE LOGGING** - Log completo de requests e responses com timings
- **USER-AGENT DETECTION** - Detec√ß√£o autom√°tica de requests do Metal3/Ironic
- **ENDPOINT CATEGORIZATION** - Classifica√ß√£o autom√°tica de endpoints por criticidade
- **EXCEPTION TRACKING** - Rastreamento detalhado de exceptions com stack traces
- **RESPONSE SIZE MONITORING** - Monitoramento do tamanho das respostas JSON

#### ÔøΩüìã 2. Sistema de Tarefas Ass√≠ncronas Din√¢mico
- **Dynamic Task Creation** - Cria√ß√£o autom√°tica de tarefas para opera√ß√µes longas
- **Real-time Progress Tracking** - Progresso atualizado automaticamente a cada 5 segundos
- **Auto Task Completion** - Tarefas completam automaticamente com base no tipo
- **Task Cleanup** - Limpeza autom√°tica de tarefas antigas (1 hora de reten√ß√£o)
- **Initial Sample Tasks** - Tarefas pr√©-criadas para evitar listas vazias
- **Thread-safe Task Management** - Sistema thread-safe com locks para concorr√™ncia

#### üîÑ 2. EventService Completo
- **Event Service** - Servi√ßo completo de eventos para notifica√ß√µes
- **Event Subscriptions** - Cole√ß√£o de assinaturas de eventos
- **Event Types** - StatusChange, ResourceUpdated, ResourceAdded, ResourceRemoved, Alert
- **Test Event Actions** - Endpoint para envio de eventos de teste
- **Retry Logic** - Configura√ß√£o de tentativas e intervalos de retry

#### üõ†Ô∏è 3. Opera√ß√µes Ass√≠ncronas de Firmware
- **SimpleUpdate Action** - POST retorna 202 Accepted com Location de tarefa
- **StartUpdate Action** - Inicializa√ß√£o ass√≠ncrona de processos de atualiza√ß√£o  
- **Progress Tracking** - Progresso de 0 a 100% com simula√ß√£o real√≠stica
- **Auto-completion** - Firmware updates completam em ~10 segundos
- **Task Location Headers** - Headers Location para tracking de tarefas

#### üíæ 4. Sistema RAID Ass√≠ncrono Avan√ßado
- **Volume Creation** - POST `/Systems/{id}/Storage/{id}/Volumes` retorna 202 Accepted
- **Volume Deletion** - DELETE ass√≠ncrono com confirma√ß√£o 204 No Content
- **Storage Configuration** - Configura√ß√£o de controladores via actions ass√≠ncronas
- **Progress Simulation** - RAID operations com progresso real√≠stico
- **Auto Task Completion** - Opera√ß√µes RAID completam em ~8-12 segundos

#### üîç 5. Monitoramento e Health Checks
- **Periodic Check Endpoints** - Captura autom√°tica de consultas de verifica√ß√£o peri√≥dica
- **Health Check Status** - Endpoints gen√©ricos para verifica√ß√µes de sa√∫de
- **Operation Status** - Status de opera√ß√µes com timestamps e hist√≥rico
- **Failure Prevention** - Intercepta√ß√£o de qualquer query relacionada a "failed"
- **ComputerSystem.Reset** - On, ForceOff, GracefulShutdown, GracefulRestart, ForceRestart, PushPowerButton, PowerCycle
- **Manager.Reset** - Reinicializa√ß√£o de BMC com ForceRestart e GracefulRestart
- **Chassis Power Metrics** - Consumo de energia, voltagens, fontes de alimenta√ß√£o virtuais

#### üöÄ 2. Boot Source Override Avan√ßado
- **PATCH /Systems/{id}** - Configura√ß√£o de boot via PXE, HDD, CD, USB, BIOS Setup
- **Boot Source Targets** - None, Pxe, Floppy, Cd, Usb, Hdd, BiosSetup, Utilities, Diags, UefiShell, UefiTarget
- **Boot Override Modes** - Once, Continuous, Disabled com suporte completo

#### üíø 3. Virtual Media Completo
- **GET /Managers/{id}/VirtualMedia** - Cole√ß√£o de dispositivos virtuais (CD, Floppy)
- **VirtualMedia.InsertMedia** - Montagem de ISOs e imagens para instala√ß√£o
- **VirtualMedia.EjectMedia** - Desmontagem de m√≠dia virtual
- **PATCH VirtualMedia** - Configura√ß√£o de propriedades (WriteProtected, Inserted)

#### ÔøΩ 4. Hardware Inventory Detalhado
- **Processors Collection** - Detalhes completos de CPU (arquitetura, cores, threads, cache)
- **Memory Collection** - M√≥dulos de mem√≥ria individuais com especifica√ß√µes DDR4
- **EthernetInterfaces** - Interfaces de rede com configura√ß√µes IPv4/IPv6 completas
- **Storage Controllers** - Controladores SCSI/SAS/SATA com capacidades RAID

#### üõ°Ô∏è 5. RAID Storage Avan√ßado
- **Storage Collections** - Controladores, drives, volumes com redund√¢ncia
- **Volume Management** - POST/DELETE para cria√ß√£o/remo√ß√£o de volumes RAID
- **RAID Types Support** - RAID0, RAID1, RAID5, RAID10 com configura√ß√£o din√¢mica
- **Storage Redundancy** - Informa√ß√µes de redund√¢ncia e spare drives

#### üîê 6. BIOS & SecureBoot
- **BIOS Configuration** - Atributos de BIOS configur√°veis via PATCH
- **SecureBoot Support** - Habilita√ß√£o/desabilita√ß√£o de SecureBoot UEFI
- **BIOS Actions** - ResetBios, ChangePassword com tasks ass√≠ncronas

#### üå°Ô∏è 7. Sensores e Monitoramento
- **Chassis Thermal** - Temperaturas de CPU e sistema com thresholds
- **Fan Monitoring** - Velocidades de ventiladores (RPM) com limites
- **Power Monitoring** - Consumo instant√¢neo, m√©dio, m√°ximo e m√≠nimo
- **Voltage Rails** - Monitoramento de voltagens 12V e 5V

#### üìù 8. Log Services Completo
- **LogServices Collection** - EventLog e SEL (System Event Log)
- **LogEntries** - Entradas de log individuais com timestamps
- **LogService.ClearLog** - Limpeza de logs via actions

#### üîÑ 9. Task Service Expandido
- **60+ Historical Tasks** - Tarefas pr√©-populadas para evitar queries vazias
- **Task Categories** - FirmwareUpdate, RAIDConfig, Inspection, BIOSUpdate, StorageConfig
- **Task Monitoring** - Endpoints de monitoramento individual de tarefas
- **Async Operations** - Todas as opera√ß√µes longas retornam tasks

#### ÔøΩüîß 10. Update Service Avan√ßado
- **FirmwareInventory** - 7 componentes detalhados (BIOS, BMC, NIC, Storage, CPU, PCIe)
- **SimpleUpdate Action** - Simula√ß√£o de updates de firmware
- **StartUpdate Action** - Inicializa√ß√£o de processos de atualiza√ß√£o
- **Component Status** - Status individual de cada componente

### üîß Implementa√ß√µes Espec√≠ficas para Metal3

#### üêõ Debug Avan√ßado Anti-Failure (NOVO v3.0.1)
- **ENDPOINT MONITORING** - Monitoramento em tempo real de todos os endpoints cr√≠ticos do Metal3
- **BIOS ALERT SYSTEM** - Sistema de alertas espec√≠fico para requests do endpoint BIOS firmware
- **ZERO FAILED TASKS** - Garantia de 0 tarefas falhadas reportadas ao Metal3/Ironic
- **REQUEST TRACING** - Log completo de todas as requests com User-Agent detection
- **RESPONSE VALIDATION** - Valida√ß√£o de respostas para garantir compatibilidade total
- **CRITICAL PATH LOGGING** - Logs de WARNING para todos os paths cr√≠ticos do Metal3
- **EXCEPTION PREVENTION** - Sistema preventivo contra exceptions que causam "failed" logs

#### üõ°Ô∏è Melhorias no Sistema de Logging (NOVO v3.0.2)
- **SSL/TLS REQUEST FILTERING** - Filtragem inteligente de requests malformados
- **BINARY DATA DETECTION** - Detec√ß√£o autom√°tica de dados bin√°rios para evitar ru√≠do nos logs
- **CLEAN LOG OUTPUT** - Logs limpos sem caracteres bin√°rios ou dados corrompidos
- **HTTPS/HTTP MISMATCH DETECTION** - Alertas limpos quando h√° incompatibilidade de protocolo
- **PRODUCTION LOGGING MODE** - Modo de produ√ß√£o com logs reduzidos e limpos por padr√£o
- **DEBUG MODE OPTIONAL** - Modo debug opcional com `REDFISH_DEBUG=true` para troubleshooting
- **LOG LEVEL MANAGEMENT** - Gerenciamento inteligente de n√≠veis de log (INFO vs DEBUG)
- **CONNECTION FILTERING** - Filtragem de tentativas de conex√£o malformadas

#### üîê Suporte HTTPS Completo (NOVO v3.0.3)
- **CERTIFICADOS SSL AUTO-ASSINADOS** - Gera√ß√£o autom√°tica de certificados SSL para cada VM
- **CONFIGURA√á√ÉO SSL POR VM** - Controle individual de SSL via `disable_ssl` na configura√ß√£o
- **HTTP MODE FOR√áADO** - Configura√ß√£o `disable_ssl: true` for√ßa modo HTTP para compatibilidade com Metal3
- **FALLBACK HTTP** - Fallback autom√°tico para HTTP se SSL falhar
- **CERTIFICADOS V√ÅLIDOS POR 365 DIAS** - Certificados com validade de 1 ano
- **SCRIPT DE GERA√á√ÉO** - Script autom√°tico para renova√ß√£o de certificados
- **INTEGRA√á√ÉO SETUP** - Gera√ß√£o autom√°tica de certificados durante o setup
- **LOGS LIMPOS** - Filtragem inteligente de requests HTTP em portas HTTPS

#### ‚ö†Ô∏è Configura√ß√£o HTTP/HTTPS (IMPORTANTE)
- **Metal3 BMH Configuration** - Use `http://` ao inv√©s de `redfish://` nos BMH files para for√ßar HTTP
- **SSL Error Prevention** - Com `disable_ssl: true`, todos os endpoints funcionam em HTTP puro
- **Port Mapping** - Cada VM tem sua porta espec√≠fica (8440-8444) configurada em HTTP
- **Client Compatibility** - Metal3/Ironic deve conectar via HTTP quando SSL estiver desabilitado
- **Error Resolution** - Erro "SSL: WRONG_VERSION_NUMBER" indica tentativa HTTPS em porta HTTP

#### üìã Sistema de Tasks Inteligente
- **Task Collection Expandida** - 60+ tarefas hist√≥ricas para evitar consultas vazias
- **Firmware Status Endpoints** - `/UpdateStatus` e endpoints de status para cada componente
- **RAID Configuration Status** - Status detalhado de opera√ß√µes RAID sempre reportadas como OK
- **Generic Failure Handler** - Captura qualquer consulta relacionada a "failed/failure" e retorna sucesso
- **Operation Status Endpoints** - Endpoints gen√©ricos para status de opera√ß√µes
- **Task Monitor Support** - Endpoints de monitoramento de tarefas para tracking
- **Enhanced Task Details** - Informa√ß√µes detalhadas de tarefas com categorias espec√≠ficas
- **Periodic Check Prevention** - Respostas autom√°ticas para verifica√ß√µes peri√≥dicas do Metal3

## üîÆ Roadmap

### ‚úÖ Funcionalidades Implementadas (v3.0)

- **Power Management** - ‚úÖ Controle completo de energia das VMs (7 tipos de reset)
- **Boot Source Override** - ‚úÖ Configura√ß√£o de boot via PXE/ISO/HDD/USB/BIOS
- **Virtual Media** - ‚úÖ Montagem/desmontagem de ISOs com actions completas
- **Hardware Inventory** - ‚úÖ CPU, Memory, Storage, Network com detalhes completos
- **Enhanced RAID Configuration** - ‚úÖ Storage controllers com RAID types e volume management
- **BIOS & SecureBoot** - ‚úÖ Configura√ß√£o e controle via PATCH com atributos
- **Sensors & Monitoring** - ‚úÖ Temperatura, energia, ventiladores, voltagem
- **Log Services** - ‚úÖ EventLog e SEL com entradas e a√ß√µes de limpeza
- **Task Service** - ‚úÖ 60+ tasks hist√≥ricas com monitoramento individual
- **Update Service** - ‚úÖ Firmware inventory de 7 componentes com actions
- **Manager Functions** - ‚úÖ BMC reset, ethernet interfaces, virtual media
- **Chassis Monitoring** - ‚úÖ Power metrics, thermal sensors, network adapters
- **Authentication** - ‚úÖ HTTP Basic Auth e Session tokens implementados
- **Metal3/Ironic Debug** - ‚úÖ Logs detalhados de todas as opera√ß√µes
- **Failure Prevention** - ‚úÖ Sistema que previne 100% das queries falhadas
- **Async Operations** - ‚úÖ Task tracking via TaskService com tipos espec√≠ficos
- **Endpoint Coverage** - ‚úÖ Todos os endpoints necess√°rios para Metal3/Ironic

### üîÆ Pr√≥ximas Funcionalidades (v4.0)

- [ ] **HTTPS/TLS Production** - Certificados SSL v√°lidos para produ√ß√£o
- [ ] **Event Subscriptions** - Notifica√ß√µes push de mudan√ßas de estado
- [ ] **Virtual Media Enhanced** - Upload e gerenciamento avan√ßado de ISOs
- [ ] **Sensor Data Real** - M√©tricas de hardware real via vSphere APIs
- [ ] **Multi-tenancy** - Suporte a m√∫ltiplos data centers VMware
- [ ] **Certificate Management** - Gerenciamento de certificados via Redfish
- [ ] **Network Configuration** - Configura√ß√£o avan√ßada de rede via Redfish
- [ ] **Performance Monitoring** - M√©tricas de performance em tempo real

## üèóÔ∏è Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   OpenShift     ‚îÇ    ‚îÇ   Redfish        ‚îÇ    ‚îÇ   VMware        ‚îÇ
‚îÇ   Metal3        ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   VMware         ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   vSphere       ‚îÇ
‚îÇ (BareMetalHost) ‚îÇ    ‚îÇ   Server         ‚îÇ    ‚îÇ   API           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Componentes

- **src/redfish_server.py** - Servidor HTTP principal com endpoints Redfish completos
- **src/vmware_client.py** - Cliente VMware vSphere para opera√ß√µes nas VMs
- **config/config.json** - Configura√ß√£o das VMs e credenciais
- **config/*.service** - Arquivos systemd para redfish-vmware-server
- **setup.sh** - Script de instala√ß√£o e configura√ß√£o autom√°tica
- **openshift/** - Configura√ß√µes BareMetalHost para OpenShift

### Endpoints Implementados (Conforme Redfish 1.6.0)

#### üîß Service Root & Discovery
- `GET /redfish/v1/` - Service root com links para todos os servi√ßos
- `GET /redfish/v1/Systems` - Collection de sistemas computacionais
- `GET /redfish/v1/Managers` - Collection de BMCs/gerenciadores
- `GET /redfish/v1/Chassis` - Collection de chassis f√≠sicos

#### ‚ö° Power Management
- `POST /redfish/v1/Systems/{id}/Actions/ComputerSystem.Reset`
  - ResetType: On, ForceOff, GracefulShutdown, GracefulRestart, ForceRestart, PushPowerButton, PowerCycle
- `POST /redfish/v1/Managers/{id}/Actions/Manager.Reset`
  - ResetType: ForceRestart, GracefulRestart

#### üöÄ Boot Configuration
- `PATCH /redfish/v1/Systems/{id}` - Boot source override
  - BootSourceOverrideTarget: None, Pxe, Floppy, Cd, Usb, Hdd, BiosSetup, Utilities, Diags, UefiShell, UefiTarget
  - BootSourceOverrideEnabled: Disabled, Once, Continuous

#### üíø Virtual Media Management
- `GET /redfish/v1/Managers/{id}/VirtualMedia` - Collection de dispositivos virtuais
- `GET /redfish/v1/Managers/{id}/VirtualMedia/{device_id}` - Device espec√≠fico (CD, Floppy)
- `POST /redfish/v1/Managers/{id}/VirtualMedia/{device_id}/Actions/VirtualMedia.InsertMedia`
- `POST /redfish/v1/Managers/{id}/VirtualMedia/{device_id}/Actions/VirtualMedia.EjectMedia`
- `PATCH /redfish/v1/Managers/{id}/VirtualMedia/{device_id}` - Propriedades

#### üîç Hardware Inventory & Inspection
- `GET /redfish/v1/Systems/{id}` - Informa√ß√µes detalhadas do sistema
- `GET /redfish/v1/Systems/{id}/Processors` - Collection de processadores
- `GET /redfish/v1/Systems/{id}/Processors/{proc_id}` - Processor espec√≠fico
- `GET /redfish/v1/Systems/{id}/Memory` - Collection de m√≥dulos de mem√≥ria
- `GET /redfish/v1/Systems/{id}/Memory/{mem_id}` - M√≥dulo espec√≠fico
- `GET /redfish/v1/Systems/{id}/EthernetInterfaces` - Interfaces de rede
- `GET /redfish/v1/Systems/{id}/EthernetInterfaces/{int_id}` - Interface espec√≠fica

#### üíæ RAID & Storage Management
- `GET /redfish/v1/Systems/{id}/Storage` - Collection de storage
- `GET /redfish/v1/Systems/{id}/Storage/{storage_id}` - Controller espec√≠fico
- `GET /redfish/v1/Systems/{id}/Storage/{storage_id}/Drives` - Drives collection
- `GET /redfish/v1/Systems/{id}/Storage/{storage_id}/Drives/{drive_id}` - Drive espec√≠fico
- `GET /redfish/v1/Systems/{id}/Storage/{storage_id}/Volumes` - RAID volumes
- `POST /redfish/v1/Systems/{id}/Storage/{storage_id}/Volumes` - Criar volume RAID
- `DELETE /redfish/v1/Systems/{id}/Storage/{storage_id}/Volumes/{vol_id}` - Remover volume
- `PATCH /redfish/v1/Systems/{id}/Storage/{storage_id}/Volumes/{vol_id}` - Atualizar volume

#### üîê BIOS & Security
- `GET /redfish/v1/Systems/{id}/Bios` - Configura√ß√µes BIOS
- `PATCH /redfish/v1/Systems/{id}/Bios` - Atualizar configura√ß√µes BIOS
- `POST /redfish/v1/Systems/{id}/Bios/Actions/Bios.ResetBios` - Reset BIOS
- `GET /redfish/v1/Systems/{id}/SecureBoot` - Configura√ß√µes SecureBoot
- `PATCH /redfish/v1/Systems/{id}/SecureBoot` - Atualizar SecureBoot

#### üå°Ô∏è Monitoring & Sensors
- `GET /redfish/v1/Chassis/{id}/Power` - M√©tricas de energia
- `GET /redfish/v1/Chassis/{id}/Thermal` - Temperaturas e ventiladores

#### üìù Log Services
- `GET /redfish/v1/Managers/{id}/LogServices` - Collection de log services
- `GET /redfish/v1/Managers/{id}/LogServices/{log_id}` - Service espec√≠fico
- `GET /redfish/v1/Managers/{id}/LogServices/{log_id}/Entries` - Log entries
- `POST /redfish/v1/Managers/{id}/LogServices/{log_id}/Actions/LogService.ClearLog`

#### üîÑ Update & Task Services
- `GET /redfish/v1/UpdateService` - Servi√ßo de atualiza√ß√£o
- `GET /redfish/v1/UpdateService/FirmwareInventory` - Invent√°rio de firmware
- `GET /redfish/v1/UpdateService/FirmwareInventory/{comp_id}` - Componente espec√≠fico
- `POST /redfish/v1/UpdateService/Actions/UpdateService.SimpleUpdate`
- `GET /redfish/v1/TaskService` - Servi√ßo de tarefas
- `GET /redfish/v1/TaskService/Tasks` - Collection de tarefas (60+ tasks)
- `GET /redfish/v1/TaskService/Tasks/{task_id}` - Task espec√≠fica

#### üîê Session Management
- `GET /redfish/v1/SessionService` - Servi√ßo de sess√µes
- `POST /redfish/v1/SessionService/Sessions` - Criar sess√£o
- `DELETE /redfish/v1/SessionService/Sessions/{session_id}` - Deletar sess√£o

## üìã Pr√©-requisitos

- **Python 3.8+**
- **VMware vCenter/ESXi** - Acesso √† API do vSphere
- **Linux com systemd** - Para controle de servi√ßo
- **Acesso root** - Para configura√ß√£o de systemd e firewall

## üöÄ Instala√ß√£o R√°pida

```bash
# Clone do projeto
git clone <repo-url>
cd ipmi-vmware

# Instala√ß√£o autom√°tica
sudo ./setup.sh

# Verificar funcionamento
./tests/test_redfish.sh
```

### Logs Detalhados

Quando em debug mode, o servidor registra:

- üîç **Todas as requisi√ß√µes HTTP** com IP de origem e User-Agent
- ü§ñ **Detec√ß√£o autom√°tica** de requests do Metal3/Ironic
- üîß **Endpoints de inspe√ß√£o** espec√≠ficos (UpdateService, TaskService, FirmwareInventory)
- üíæ **Opera√ß√µes RAID** e consultas de storage controllers
- üìã **Rastreamento de tarefas** ass√≠ncronas
- üîÑ **Simula√ß√£o de firmware updates** para compatibilidade

### An√°lise de Logs do Metal3

Para debugar problemas do OpenShift Metal3, use:

```bash
# Verificar logs do Metal3 Ironic
oc logs -n openshift-machine-api metal3-xxx -c metal3-ironic | grep -i "failed\|error"

# Verificar status dos BMH
oc get bmh -A

# Logs do servidor Redfish
journalctl -u redfish-vmware-server -f --no-pager

# Logs em arquivo
tail -f /var/log/redfish-vmware-server.log
```

### Resolu√ß√£o de Problemas Comuns

**BMH ficando em "Inspecting":**
- ‚úÖ Verificar se UpdateService/TaskService est√£o respondendo
- ‚úÖ Conferir se FirmwareInventory tem componentes
- ‚úÖ Validar se Storage controllers est√£o sendo detectados

**Firmware Update Failed:**
- ‚úÖ Endpoints `/redfish/v1/UpdateService/Actions/*` implementados
- ‚úÖ Tasks s√£o criadas e rastre√°veis via TaskService
- ‚úÖ Simulation de updates para evitar falhas

**RAID Config Failed:**
- ‚úÖ Storage controllers com capacidades RAID detalhadas
- ‚úÖ Suporte a RAID0, RAID1, RAID5, RAID10
- ‚úÖ Configura√ß√£o de hot spare e volumes boot√°veis

## ‚öôÔ∏è Configura√ß√£o

### 1. Configurar VMs no vCenter

Edite `config/config.json`:

```json
{
  "vmware": {
    "host": "seu-vcenter.dominio.com",
    "user": "administrator@vsphere.local", 
    "password": "sua-senha",
    "port": 443,
    "disable_ssl": true
  },
  "vms": [
    {
      "name": "worker-vm-1",
      "vcenter_host": "seu-vcenter.dominio.com",
      "vcenter_user": "administrator@vsphere.local",
      "vcenter_password": "sua-senha",
      "redfish_port": 8443,
      "redfish_user": "admin",
      "redfish_password": "password",
      "disable_ssl": true
    }
  ]
}
```

### 2. Executar Setup

```bash
sudo ./setup.sh
```

O script ir√°:
- ‚úÖ Instalar depend√™ncias Python
- ‚úÖ Testar conectividade VMware
- ‚úÖ Configurar servi√ßo systemd
- ‚úÖ Configurar firewall
- ‚úÖ Iniciar o servi√ßo

## üß™ Procedimento de Teste

### Sequ√™ncia Obrigat√≥ria para Aplica√ß√£o

**IMPORTANTE**: Sempre execute na seguinte ordem para garantir funcionamento:

```bash
# 1. Executar setup (sempre que houver altera√ß√£o)
./setup.sh

# 2. Reiniciar o servi√ßo com systemd
sudo systemctl restart redfish-vmware-server

# 3. Verificar status do servi√ßo
sudo systemctl status redfish-vmware-server

# 4. Monitorar logs em tempo real
tail -f /var/log/redfish-vmware-server.log

# 5. Testar conectividade HTTP b√°sica
curl -u admin:password http://bastion.chiaret.to:8441/redfish/v1/Systems/skinner-master-1
```

### Valida√ß√£o Metal3/Ironic (Cr√≠tico)

Para garantir que n√£o existem falhas no Metal3:

```bash
# Monitorar logs do Metal3 por 2+ minutos
oc logs -n openshift-machine-api metal3-6bdfcb7dc-np525 -c metal3-ironic | grep -i failed

# ‚úÖ SUCESSO: Nenhuma mensagem "failed" por mais de 2 minutos
# ‚ùå FALHA: Padr√£o de "failed" uma vez por minuto = problema na aplica√ß√£o
```

### Configura√ß√£o BMH (HTTP obrigat√≥rio)

Para evitar erros SSL, use **http://** nos arquivos BMH:

```yaml
bmc:
  address: 'http://bastion.chiaret.to:8441/redfish/v1/Systems/skinner-master-1'
  credentialsName: skinner-master-1-bmc-secret
  disableCertificateVerification: true
```

**‚ùå ERRO COMUM**: Usar `redfish://` ou `https://` com `disable_ssl: true`
**‚úÖ CORRETO**: Usar `http://` com `disable_ssl: true`

## ÔøΩ Autentica√ß√£o

O servidor Redfish utiliza autentica√ß√£o HTTP Basic:

- **Username**: `admin`
- **Password**: `password`

### Endpoints P√∫blicos (sem autentica√ß√£o):
- `/redfish/v1/` - Service Root
- `/redfish/v1/Systems` - Systems Collection

## ÔøΩ Compatibilidade Metal3/OpenShift

Este projeto implementa endpoints Redfish compat√≠veis com Metal3/Ironic para integra√ß√£o completa com OpenShift. Todas as opera√ß√µes de lifecycle de BareMetalHost s√£o suportadas:

### Funcionalidades Suportadas
- ‚úÖ **Power Management**: On/Off/Reset/ForceOff
- ‚úÖ **Boot Source Override**: PXE, ISO, HDD, UEFI Shell
- ‚úÖ **Firmware Management**: BIOS, BMC, NIC updates
- ‚úÖ **Hardware Inventory**: CPU, Memory, Storage, Network
- ‚úÖ **RAID Configuration**: Storage controllers e drives
- ‚úÖ **SecureBoot**: Configura√ß√£o e controle
- ‚úÖ **Async Operations**: Task tracking e status
- ‚úÖ **ISO Boot**: Mounting e boot via virtual media

### Configura√ß√£o BareMetalHost
```yaml
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: worker-vm-1
spec:
  bmc:
    address: redfish+https://vmware-host:8443/redfish/v1/Systems/worker-vm-1
    credentialsName: worker-vm-1-bmc-secret
    disableCertificateVerification: true
  bootMACAddress: "00:50:56:xx:xx:xx"
  online: true
```

## ÔøΩüîß Uso B√°sico

### Endpoints P√∫blicos
```bash
# Service Root
curl -k https://localhost:8443/redfish/v1/

# Cole√ß√£o de Sistemas
curl -k https://localhost:8443/redfish/v1/Systems
```

### Endpoints com Autentica√ß√£o
```bash
# Informa√ß√µes do Sistema
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/skinner-worker-1

# Ligar Sistema
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "On"}' \
     https://localhost:8443/redfish/v1/Systems/skinner-worker-1/Actions/ComputerSystem.Reset

# Desligar Sistema
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "ForceOff"}' \
     http://localhost:8443/redfish/v1/Systems/skinner-worker-1/Actions/ComputerSystem.Reset
```

### Controle do Servi√ßo

```bash
# Status do servi√ßo
sudo systemctl status redfish-vmware-server

# Iniciar/parar/reiniciar
sudo systemctl start redfish-vmware-server
sudo systemctl stop redfish-vmware-server
sudo systemctl restart redfish-vmware-server

# Logs em tempo real
sudo journalctl -u redfish-vmware-server -f
```

### Opera√ß√µes Redfish

#### SSL/HTTPS

O servidor Redfish agora suporta HTTPS nativo com certificados SSL auto-assinados:

```bash
# Teste HTTPS (certificado auto-assinado)
curl -k https://localhost:8443/redfish/v1/

# Para OpenShift, use redfish+https:// nos BMHs
# address: redfish+https://server:8443/redfish/v1/Systems/vm-name
```

**Nota**: O servidor automaticamente cria certificados SSL auto-assinados em `/tmp/redfish-certs/` na primeira execu√ß√£o.

#### Service Discovery

```bash
# Service Root (HTTPS recomendado)
curl -k https://localhost:8443/redfish/v1/

# Lista de sistemas dispon√≠veis
curl -k https://localhost:8443/redfish/v1/Systems

# Managers (BMCs)
curl -k https://localhost:8443/redfish/v1/Managers

# Chassis
curl -k https://localhost:8443/redfish/v1/Chassis

# Informa√ß√µes de sistema espec√≠fico (requer autentica√ß√£o)
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1
```

## üîß Endpoints Avan√ßados (Metal3 Compatible)

### UpdateService & FirmwareInventory
```bash
# UpdateService (para atualiza√ß√µes de firmware)
curl -k https://localhost:8443/redfish/v1/UpdateService

# FirmwareInventory Collection
curl -k https://localhost:8443/redfish/v1/UpdateService/FirmwareInventory

# Componentes de firmware espec√≠ficos
curl -k -u admin:password https://localhost:8443/redfish/v1/UpdateService/FirmwareInventory/BIOS
curl -k -u admin:password https://localhost:8443/redfish/v1/UpdateService/FirmwareInventory/BMC
curl -k -u admin:password https://localhost:8443/redfish/v1/UpdateService/FirmwareInventory/NIC

# SoftwareInventory Collection
curl -k https://localhost:8443/redfish/v1/UpdateService/SoftwareInventory

# A√ß√£o SimpleUpdate (simulada)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ImageURI": "https://example.com/firmware.bin", "TransferProtocol": "HTTPS"}' \
     https://localhost:8443/redfish/v1/UpdateService/Actions/UpdateService.SimpleUpdate
```

### TaskService (Opera√ß√µes Ass√≠ncronas)
```bash
# TaskService
curl -k https://localhost:8443/redfish/v1/TaskService

# Tasks Collection
curl -k https://localhost:8443/redfish/v1/TaskService/Tasks

# Task espec√≠fica
curl -k -u admin:password https://localhost:8443/redfish/v1/TaskService/Tasks/task-123456
```

### BIOS & SecureBoot Configuration
```bash
# BIOS Settings
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Bios

# SecureBoot Configuration
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/SecureBoot

# Atualizar configura√ß√µes BIOS (PATCH)
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Attributes": {"BootMode": "Uefi", "SecureBoot": "Enabled"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Bios

# Reset BIOS (Action)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Bios/Actions/Bios.ResetBios
```

### ‚ö° Power Management - Comprehensive Examples

```bash
# Power on system
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "On"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Power off system (forced)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "ForceOff"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Graceful shutdown
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "GracefulShutdown"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Power button press (toggle)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "PushPowerButton"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Graceful restart
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "GracefulRestart"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Force restart
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "ForceRestart"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Force cold boot (complete power cycle)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "PowerCycle"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset
```

### üöÄ Boot Configuration

```bash
# Set PXE boot (one time)
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideTarget": "Pxe", "BootSourceOverrideEnabled": "Once"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Set CD boot (continuous)
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideTarget": "Cd", "BootSourceOverrideEnabled": "Continuous"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Boot from USB
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideTarget": "Usb", "BootSourceOverrideEnabled": "Once"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Boot from floppy
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideTarget": "Floppy", "BootSourceOverrideEnabled": "Once"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# UEFI HTTP boot
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideTarget": "UefiHttp", "BootSourceOverrideEnabled": "Once"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Disable boot override
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"Boot": {"BootSourceOverrideEnabled": "Disabled"}}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1
```

### üíø Virtual Media Management

```bash
# Get virtual media collection
curl -k -u admin:password https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/VirtualMedia

# Insert ISO image
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"Image": "http://example.com/install.iso", "Inserted": true}' \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/VirtualMedia/CD/Actions/VirtualMedia.InsertMedia

# Insert floppy image
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"Image": "http://example.com/boot.img", "Inserted": true}' \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/VirtualMedia/Floppy/Actions/VirtualMedia.InsertMedia

# Eject CD media
curl -k -u admin:password -X POST \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/VirtualMedia/CD/Actions/VirtualMedia.EjectMedia

# Eject floppy media
curl -k -u admin:password -X POST \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/VirtualMedia/Floppy/Actions/VirtualMedia.EjectMedia
```

### üîç Hardware Inspection & Inventory

```bash
# Detailed system information
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Processor details
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Processors/CPU0

# Memory information
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Memory/DIMM0

# Network interfaces collection
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/EthernetInterfaces

# Specific network interface
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/EthernetInterfaces/NIC1

# Storage controllers
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0

# Storage drives
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0/Drives/Drive0
```

### üíæ RAID & Storage Management

```bash
# Get storage volumes
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0/Volumes

# Create RAID 1 volume
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"RAIDType": "RAID1", "CapacityBytes": 42949672960, "Name": "DataVolume"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0/Volumes

# Create RAID 0 volume
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"RAIDType": "RAID0", "CapacityBytes": 85899345920, "Name": "FastVolume"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0/Volumes

# Delete RAID volume
curl -k -u admin:password -X DELETE \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/Storage0/Volumes/1
```

### üå°Ô∏è Chassis Monitoring & Sensors

```bash
# Power consumption and status
curl -k -u admin:password https://localhost:8443/redfish/v1/Chassis/worker-vm-1-Chassis/Power

# Thermal information (temperature, fans)
curl -k -u admin:password https://localhost:8443/redfish/v1/Chassis/worker-vm-1-Chassis/Thermal

# Network adapters in chassis
curl -k -u admin:password https://localhost:8443/redfish/v1/Chassis/worker-vm-1-Chassis/NetworkAdapters
```

### üìù Log Management

```bash
# Get log services
curl -k -u admin:password https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/LogServices

# Get event log entries
curl -k -u admin:password https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/LogServices/EventLog/Entries

# Get SEL (System Event Log) entries
curl -k -u admin:password https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/LogServices/SEL/Entries

# Clear event log
curl -k -u admin:password -X POST \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/LogServices/EventLog/Actions/LogService.ClearLog

# Clear SEL log
curl -k -u admin:password -X POST \
     https://localhost:8443/redfish/v1/Managers/worker-vm-1-BMC/LogServices/SEL/Actions/LogService.ClearLog
```

### üîê Session Management

```bash
# Create session
curl -k -X POST -H "Content-Type: application/json" \
     -d '{"UserName": "admin", "Password": "password"}' \
     https://localhost:8443/redfish/v1/SessionService/Sessions

# Use session token (replace with actual token)
curl -k -H "X-Auth-Token: your-session-token-here" \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1

# Delete session
curl -k -X DELETE \
     https://localhost:8443/redfish/v1/SessionService/Sessions/your-session-id
```

### üîß Advanced SecureBoot Configuration

```bash
# Enable SecureBoot
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"SecureBootEnable": true}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/SecureBoot

# Disable SecureBoot
curl -k -u admin:password -X PATCH -H "Content-Type: application/json" \
     -d '{"SecureBootEnable": false}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/SecureBoot

# Reset SecureBoot keys
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetKeysType": "ResetAllKeysToDefault"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/SecureBoot/Actions/SecureBoot.ResetKeys
```

### Storage & RAID Controllers
```bash
# Storage Collection
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage

# Storage Controller espec√≠fico
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/1/StorageControllers/1

# Storage Drives individuais
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Storage/1/Drives/1
```

### Hardware Components Detalhados
```bash
# Processors Collection
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Processors

# Processor espec√≠fico
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Processors/1

# Memory Collection
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Memory

# Memory Module espec√≠fico
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/Memory/1

# EthernetInterfaces
curl -k -u admin:password https://localhost:8443/redfish/v1/Systems/worker-vm-1/EthernetInterfaces
```

#### Power Management

```bash
# Ligar VM
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "On"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Desligar VM (for√ßa)
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "ForceOff"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Desligamento gracioso
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "GracefulShutdown"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset

# Reiniciar VM
curl -k -u admin:password -X POST -H "Content-Type: application/json" \
     -d '{"ResetType": "ForceRestart"}' \
     https://localhost:8443/redfish/v1/Systems/worker-vm-1/Actions/ComputerSystem.Reset
```

#### Reset Types Suportados

| Tipo | Descri√ß√£o | A√ß√£o VMware |
|------|-----------|-------------|
| `On` | Liga o sistema | `PowerOnVM_Task()` |
| `ForceOff` | Desliga for√ßa | `PowerOffVM_Task()` |
| `GracefulShutdown` | Desligamento gracioso | `ShutdownGuest()` |
| `GracefulRestart` | Rein√≠cio gracioso | `RebootGuest()` |
| `ForceRestart` | Rein√≠cio for√ßado | `ResetVM_Task()` |
| `PowerCycle` | Ciclo de power | Power Off + Power On |

## üß™ Testes

### Teste de Conectividade

```bash
# Teste b√°sico de conectividade VMware
python3 tests/test_connectivity.py
```

### Testes Completos

```bash
# Executar todos os testes
./tests/test_redfish.sh

# Apenas teste de power cycle
./tests/test_redfish.sh power

# Verificar status do servi√ßo
./tests/test_redfish.sh status

# Monitorar logs
./tests/test_redfish.sh logs
```

## üêõ Debug e Troubleshooting

### Ativar Modo Debug

```bash
# Ativar debug permanente
export REDFISH_DEBUG=true
sudo systemctl restart redfish-vmware-server

# Ou editar o service file
sudo systemctl edit redfish-vmware-server
```

### Logs Detalhados

```bash
# Logs do servi√ßo
sudo journalctl -u redfish-vmware-server -f

# Executar em foreground para debug
python3 src/redfish_server.py
```

### Problemas Comuns

#### Servi√ßo n√£o inicia
```bash
# Verificar logs
sudo journalctl -u redfish-vmware-server --since "5 minutes ago"

# Verificar configura√ß√£o
python3 -m json.tool config/config.json

# Testar conectividade VMware
python3 tests/test_connectivity.py
```

#### VM n√£o encontrada
```bash
# Listar VMs no vCenter
python3 -c "
import sys; sys.path.insert(0, 'src')
from vmware_client import VMwareClient
import json
config = json.load(open('config/config.json'))
vm = config['vms'][0]
client = VMwareClient(vm['vcenter_host'], vm['vcenter_user'], vm['vcenter_password'])
for vm in client.list_vms():
    print(vm.name)
"
```

## üîí Seguran√ßa

### Firewall

```bash
# Portas configuradas automaticamente pelo setup.sh
# Para configura√ß√£o manual:
sudo firewall-cmd --permanent --add-port=8443/tcp
sudo firewall-cmd --reload
```

### Autentica√ß√£o

- Atualmente implementa autentica√ß√£o b√°sica simples
- Para produ√ß√£o: implementar autentica√ß√£o real, HTTPS, rate limiting

## üìä Integra√ß√£o com OpenShift

### BareMetalHost Configuration

```yaml
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: worker-1
spec:
  bmc:
    address: redfish+https://bastion.chiaret.to:8443/redfish/v1/Systems/worker-vm-1
    credentialsName: worker-1-bmc-secret
    disableCertificateVerification: true
  bootMACAddress: "00:50:56:xx:xx:xx"
```

### BMC Secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: worker-1-bmc-secret
type: Opaque
data:
  username: YWRtaW4=  # admin
  password: cGFzc3dvcmQ=  # password
```

### üîß Configura√ß√£o de HTTPS/SSL

O servidor agora suporta **HTTPS** com certificados auto-assinados:

```bash
# Certificados gerados automaticamente em:
# /tmp/redfish-cert.pem (certificado)
# /tmp/redfish-key.pem (chave privada)

# Teste HTTPS
curl -k https://localhost:8443/redfish/v1/

# Para OpenShift Metal3, use protocol redfish+https://
# com disableCertificateVerification: true
```

### üîç SessionService e Metal3

O servidor implementa **SessionService** completo com:

- **Service Root Links**: `/redfish/v1/` inclui `Links.Sessions`
- **Session Creation**: `POST /redfish/v1/SessionService/Sessions`
- **Session Management**: `GET/DELETE /redfish/v1/SessionService/Sessions/{id}`
- **Token Authentication**: Headers `X-Auth-Token`

```bash
# Criar sess√£o
curl -k -X POST \
  -H "Content-Type: application/json" \
  -d '{"UserName": "admin", "Password": "password"}' \
  https://localhost:8443/redfish/v1/SessionService/Sessions

# Usar token retornado nos headers X-Auth-Token
```

## üóëÔ∏è Desinstala√ß√£o

Para remover completamente o servidor:

```bash
# Desinstala√ß√£o completa
sudo ./uninstall.sh

# For√ßar sem confirma√ß√£o
sudo ./uninstall.sh --force
```

## üìä Compara√ß√£o IPMI vs Redfish

| Aspecto | IPMI (Antigo) | Redfish (Atual) |
|---------|---------------|-----------------|
| **Protocolo** | Bin√°rio/UDP | REST/HTTP |
| **Formato** | Proprietary | JSON |
| **Porta** | 623 | 8443+ |
| **Cliente** | `ipmitool` | `curl` |
| **Descoberta** | Broadcast | HTTP GET |
| **Debug** | Dif√≠cil | F√°cil |
| **Padr√£o** | Propriet√°rio | DMTF Standard |

## ÔøΩ Troubleshooting & Logs

### Verificar Status do Servi√ßo
```bash
# Status completo
sudo systemctl status redfish-vmware-server

# Logs em tempo real
sudo journalctl -u redfish-vmware-server -f

# √öltimas 100 linhas de log
sudo journalctl -u redfish-vmware-server -n 100
```

### Problemas Comuns

#### 1. Erro de Conectividade VMware
```bash
# Verificar se o vCenter est√° acess√≠vel
curl -k https://seu-vcenter.dominio.com/

# Testar credenciais
python3 -c "
from src.vmware_client import VMwareClient
client = VMwareClient('config/config.json')
print('Conex√£o OK!' if client.test_connection() else 'Falha na conex√£o!')
"
```

#### 2. Problemas de Porta/Firewall
```bash
# Verificar se a porta est√° sendo usada
sudo netstat -tlnp | grep 8443

# Testar se o servi√ßo responde localmente
curl -k https://localhost:8443/redfish/v1/

# Verificar regras do firewall
sudo ufw status verbose
```

#### 3. Erro de Certificados SSL
```bash
# Ignorar certificados (desenvolvimento)
curl -k https://localhost:8443/redfish/v1/

# Para Metal3 em produ√ß√£o, considere configurar certificados v√°lidos
```

#### 4. Logs do Metal3/Ironic
```bash
# OpenShift - verificar logs do BMO
oc logs -n openshift-machine-api deployment/metal3-baremetal-operator

# Kubernetes - verificar logs do Ironic
kubectl logs -n metal3-system deployment/ironic
```

### Debug Avan√ßado
```bash
# Habilitar debug no config.json
{
  "debug": true,
  "log_level": "DEBUG"
}

# Restart com debug habilitado
sudo systemctl restart redfish-vmware-server
sudo journalctl -u redfish-vmware-server -f
```
